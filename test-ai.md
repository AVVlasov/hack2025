
Ручное функциональное тестирование AI агентов (критичные проверки)
1. Понимание запросов (Intent Understanding)
2. Выполнение задач (Task Completion)
   2.1. Достижение цели (Goal Achievement)
   2.2. Полнота выполнения (Completeness)
   2.3. Корректность данных (Data Accuracy)
   2.4. Эффективность выполнения (Efficiency)
   Тест-кейсы формирования шагов и их выполнения, включая тулы
3. Обработка контекста (Context Management)
4. Обработка ошибок (Error Handling)
5. Качество ответов (Response Quality)
   5.1. Понятные инструкции
   5.2. Точность фактов
   Чек-лист для быстрой проверки
    - Понимание запросов
    - Выполнение задач
    - Обработка контекста
    - Обработка ошибок
    - Качество ответов
Полезная информация и рекомендации


Ручное функциональное тестирование AI агентов (критичные проверки)



1. Понимание запросов (Intent Understanding)
   Что проверяем: Правильно ли агент понимает намерение пользователя и определяет цель запроса.

Метрика: Intent Accuracy = (Правильно распознанные намерения) / (Всего запросов) × 100%

Примеры тест-кейсов:



Базовый уровень понимания запросов пользователя
Запрос: "Забронируй мне отель в Париже"
Ожидание: Агент определяет намерение = "бронирование отеля" и действует соответственно
Вариации формулировок
Запрос 1: "Мне нужна гостиница в Париже"
Запрос 2: "Найди где переночевать в Париже"
Запрос 3: "Paris hotel booking"
Ожидание: Все схожие запросы приводят к одному результату дейтсвий агента и схожему результату

Неоднозначные запросы
Запрос: "Хочу в Париж"
Ожидание: Агент задает уточняющий вопрос в соответствии с тематикой вопроса (отель? билет? информация?)

Сложные запросы (multiple intents)
Запрос: "Забронируй отель в Париже и арендуй машину"
Ожидание: Агент распознает 2 шага в flow и корректно обрабатывает шаги

Негативные кейсы
Запрос: "asdfghjkl"
Ожидание: Агент ответчает в заглушкой с просьбой уточнения ("Не в моих силах понять, пожалуйста, переформулируйте")

Запрос: "Сколько стоит биткоин?" (вне домена агента)
Ожидание: Вежливый отказ или предоставление ссылки на другой корректный ресурс

2. Выполнение задач (Task Completion)
   2.1. Достижение цели (Goal Achievement)
   Что проверяем: Достигнута ли конечная цель задачи.

Метрика: Goal Achievement Rate = (Задачи с достигнутой целью) / (Всего задач) × 100%

Пример
Задача: "Забронируй отель в Париже"
Цель: Есть подтвержденное бронирование отеля в Париже

✅ Успех: Агент выдал номер брони и детали бронирования
❌ Провал: Агент показал список отелей, но не забронировал
❌ Провал: Агент забронировал отель в Лондоне (неверный город)
2.2. Полнота выполнения (Completeness)
Что проверяем: Все ли необходимые шаги выполнены.

Метрика: Completeness Score = (Выполненные шаги) / (Необходимые шаги) × 100%

Пример
Задача: "Забронируй отель в Париже на 3 ночи с 15 апреля"
Необходимые шаги:
1. Поиск отелей (город=Париж, даты=15-18 апреля)
2. Выбор отеля
3. Подтверждение бронирования
4. Выдача номера брони

Сценарий 1:
Агент выполнил шаги 1, 2, 3, 4
Completeness = 4/4 = 100% ✅

Сценарий 2:
Агент выполнил шаги 1, 2 (показал отели, но не забронировал)
Completeness = 2/4 = 50% ❌

2.3. Корректность данных (Data Accuracy)
Что проверяем: Правильность параметров и значений в выполненной задаче.

Скорее всего при проверке потребуется изучить информацию из логов/аудита/трассировки по вызову тулов, если не предоставляется визуальное отображение работы с тулами.

Метрика: Data Accuracy = (Корректные параметры) / (Всего параметров) × 100%

Пример
Задача: "Найди рейс в Лондон на 15 апреля для 2 пассажиров"

Параметры:
- Направление: Лондон
- Дата: 15 апреля
- Пассажиры: 2

Сценарий 1:
Агент искал: Лондон, 15 апреля, 2 пассажира
Data Accuracy = 3/3 = 100% ✅

Сценарий 2:
Агент искал: Париж, 15 апреля, 2 пассажира (неверный город)
Data Accuracy = 2/3 = 67% ❌

Сценарий 3:
Агент искал: Лондон, 16 апреля, 1 пассажир (все неверно кроме города)
Data Accuracy = 1/3 = 33% ❌

2.4. Эффективность выполнения (Efficiency)
Что проверяем: Минимальное ли количество шагов использовано для достижения цели.

Скорее всего при проверке потребуется изучить информацию из логов/аудита/трассировки по вызову тулов, если не предоставляется визуальное отображение работы с тулами.

Метрика: Efficiency Score = (Минимально необходимые шаги) / (Фактически выполненные шаги) × 100%

Пример
Задача: "Какая погода в Москве?"
Оптимальный путь: 1 шаг (вызвать weather API)

Сценарий 1:
Агент: вызвал weather API
Efficiency = 1/1 = 100% ✅

Сценарий 2:
Агент: 1) вызвал geo API чтобы найти Москву
2) вызвал weather API
Efficiency = 1/2 = 50% (избыточный шаг) ⚠️

Сценарий 3:
Агент: 1) вызвал weather API для Санкт-Петербурга (ошибка)
2) вызвал weather API для Москвы (исправление)
Efficiency = 1/2 = 50% ❌

Тест-кейсы формирования шагов и их выполнения, включая тулы
Тесты данного раздела нужны для оценки корректности формирования плана шагов и вызова агентов этих шагов в рамках доменной специфики.

Скорее всего при проверке потребуется изучить информацию из логов/аудита/трассировки по вызову тулов, если не предоставляется визуальное отображение работы с тулами.

Тест flow из одного шага
Задача: "Какая погода в Москве?"
Проверяем:
✓ Вызван правильный инструмент (weather API)
✓ Передан правильный город ("Москва")
✓ Ответ содержит актуальную погоду
✓ Ответ в понятном формате

Тест flow из множества шагов
Задача: "Забронируй отель в Париже на 3 ночи с 15 апреля"
Проверяем:
✓ Шаг 1: Поиск доступных отелей (город=Париж, даты=15-18 апреля)
✓ Шаг 2: Запрос предпочтений пользователя (если нужно)
✓ Шаг 3: Выбор отеля
✓ Шаг 4: Подтверждение бронирования
✓ Шаг 5: Выдача подтверждения с номером брони
Тест flow с вызовом тулов (обращение к внешним API и ресурсам)
Задача: "Найди дешевый рейс в Лондон и отправь детали на почту"
Проверяем:
✓ Tool 1: Поиск рейсов корректно вызван
✓ Tool 2: Email отправлен с правильными данными
✓ Порядок выполнения логичен
✓ Обработка ошибок (если рейсов нет, если email не отправился)
HITL Частичное выполнение c уточнением
Задача: "Забронируй отель" (недостаточно данных)
Проверяем:
✓ Агент не выполняет задачу сразу
✓ Запрашивает недостающую информацию (город? даты?)
✓ После получения данных завершает задачу

HITL отмена шага в flow
Сценарий:
User: "Забронируй отель в Париже"
Agent: "В какие даты?"
User: "Неважно, отмени"
Проверяем:
✓ Агент корректно отменяет процесс
✓ Не выполняет частичное бронирование
✓ Подтверждает отмену

3. Обработка контекста (Context Management)
   Что проверяем: Сохраняет ли агент контекст диалога и использует ли информацию из предыдущих сообщений.

Метрика: Context Retention = (Правильные ответы с контекстом) / (Запросы требующие контекст) × 100%

Примеры тест-кейсов:

Понимание контекста переписки включая предыдущие ответы агента
User: "Покажи отели в Париже"
Agent: [показывает список]
User: "А какой самый дешевый?"
Проверяем:
✓ Агент понимает "самый дешевый" = из списка отелей в Париже
✓ Не спрашивает "самый дешевый ЧТО?"
Контекст через несколько реплик
User: "Ищу отель в Париже"
Agent: "На какие даты?"
User: "С 15 по 18 апреля"
Agent: "Вот варианты..."
User: "А если изменить даты на 20-23 апреля?"
Проверяем:
✓ Агент помнит город (Париж)
✓ Меняет только даты, не запрашивает город снова

Переключение контекста
User: "Забронируй отель в Париже"
Agent: "На какие даты?"
User: "А сколько стоят билеты в Лондон?"
Agent: [отвечает про Лондон]
User: "Вернемся к отелю - с 15 апреля"
Проверяем:
✓ Агент корректно переключает контекст
✓ Возвращается к исходному контексту бронирования
✓ Помнит город (Париж)

Забывание контекста (session boundary)
Диалог 1:
User: "Забронируй отель в Париже"
[диалог завершен]

Новый диалог:
User: "Какой отель я забронировал?"
Проверяем:
✓ Агент не имеет доступа к предыдущей сессии (если не предусмотрено long-term memory)
✓ Корректно сообщает, что нет информации
Длинный контекст (длинная переписка)
Сценарий: Диалог на 20+ сообщений
Проверяем:
✓ Агент помнит ключевую информацию из начала диалога в конце диалога
✓ Агент не теряет контекст из середины переписки в конце диалога
✓ Не теряет контекст в середине
✓ Не начинает "путаться" или повторяться
✓ Поддерживает несколько разных тем и прикладных вопрсоов в рамках диалога
Противоречивая информация
User: "Ищу отель в Париже на 3 ночи"
Agent: "С какой даты?"
User: "С 15 апреля. Нет, подожди, с 20 апреля"
Проверяем:
✓ Агент использует последнюю информацию (20 апреля)
✓ Не смешивает старые и новые данные

4. Обработка ошибок (Error Handling)
   Что проверяем: Корректно ли агент реагирует на сбои и сообщает об этом понятно.

Метрика: Error Handling Rate = (Корректно обработанные ошибки) / (Всего ошибок) × 100%

Примеры тест-кейсов:

Внешний API или тул недоступен
User: "Забронируй отель в Париже"
API: Ошибка 503

✅ Правильно:
"Сервис бронирования временно недоступен. Попробуйте через 5 минут"

❌ Неправильно:
"Готово, забронировал" (лжет)
"Error 503" (технический жаргон)
[молчание]
Внешний API или тул отвечает долго или с таймаутом
User: "Найди рейсы в Лондон"
API: Нет ответа 30+ секунд

✅ Правильно:
"Поиск занимает дольше обычного. Попробовать еще раз?"

❌ Неправильно:
[бесконечное ожидание]
Внешний API или тул отвечает с 500 или другими ошибками
User: "Найди отель в Антарктиде на завтра"
API: Список пустой

✅ Правильно:
"Не нашел отелей. Могу поискать ближайшие варианты?"

❌ Неправильно:
[показывает рандомный отель из другого города]


5. Качество ответов (Response Quality)
   5.1. Понятные инструкции
   Что проверяем: Actionable шаги, когда агент не может выполнить задачу сам.

Метрика: Instruction Clarity = (Ответы с понятными шагами) / (Ответы требующие действий) × 100%

Позитивный пример
User: "Как вернуть товар?"

✅ Хорошо:
1. Войдите на site.com
2. Откройте "Мои заказы"
3. Выберите заказ → "Вернуть товар"
4. Заполните причину
5. Распечатайте этикетку, наклейте на посылку
6. Отнесите в СДЭК
   Деньги вернутся через 5-7 дней

❌ Плохо:
"Вы можете вернуть через личный кабинет"

Негативный пример
User: "Почему не работает оплата?"

✅ Хорошо:
Проверьте:
1. Достаточно средств на карте
2. Верный CVV код
3. Включена онлайн-оплата (в приложении банка)
   Если не помогло → support@site.com

❌ Плохо:
Проверьте настройки


5.2. Точность фактов
Что проверяем: Корректность дат, цен, адресов, требований.

Метрика: Fact Accuracy = (Верные факты) / (Всего фактов) × 100%

Контекст переписки уже содержит информацию о точных ценах на доставку. Пользователь может загрузить критичную для него информацию напрямую в чат. RAG знания агента также могут содержать критичную информацию для пользователя со старта диалога.



Критичные данные в файле
User: "Загружает excel/текст таблицы с данными о ценах на доставку"
User: "Сколько стоит доставка?"
Agent: "Диапазон цены на доставку от 300₽ до 1000₽, бесплатно от 1000₽ на товары категории X..."

Проверка:
✓ Цифры совпадают с предоставленными
✗ Старые цены (при обновлении данных в том же диалоге агент должен актуализировать данные в контексте)
✓ Не перепутаны оценочные значения (от и до должны быть с корректными значениями)
Адреса, гео данные, работа со временем
User: "Где ваш офис?"
Agent: "Офис располагается по адресу: г. Томск ул. Ленина 15, офис 301. Время работы: Пн-Пт 9-18"

Проверка:
✓ Адрес актуален, соответствует действительности
✓ Предоставляется дополнительная уточняющая информация помимо адреса (время работы, телефон, ссылка на карту)
Последовательность шагов
User: "Как оформить возврат?"
Agent:
1. Откройте форму возврата в разделе X
2. Выполните подтверждение возврата
3. Внесите информацию о возврате: уточните какой товар, приложите фото, опишите причины возврата

Проверка:
✗ Неверная последовательность

Неопределенность vs Выдумывание
User: "Когда придет заказ?"

✅ Правильно:
"Доставка 3-5 дней. Точную дату узнаете по трек-номеру"

❌ Неправильно:
"Заказ придет 15 марта"
[агент не знает точную информацию о заказе, не имеет тула для поиска информации, но додумал]

Чек-лист для быстрой проверки
Понимание запросов
Распознает стандартные формулировки
Обрабатывает вариации одного намерения
Задает уточнения при неоднозначности
Корректный fallback заглушка на неизвестные запросы
Выполнение задач
Завершает простые задачи (1 шаг)
Завершает сложные задачи (multi-step)
Правильно использует инструменты/API
Запрашивает недостающую информацию
Обрабатывает отмену задачи
Обработка контекста
Использует информацию из предыдущих сообщений
Не запрашивает повторно уже известное
Корректно переключает контекст
Обрабатывает противоречивую информацию
Держит контекст в длинных диалогах (20+ реплик в диалоге)
Обработка ошибок
Понятное сообщение при сбое API
Не выдумывает успех при ошибке
Предлагает альтернативы
Качество ответов
Конкретные шаги для пользователя
Оперирует точными данными и терминами из своего домена знаний
Порядок вызова тулов / шагов для пользователя корректный
Не выдумывает факты
Отсутствуют галлюцинации


Полезная информация и рекомендации
Для ручного тестирования:

Готовьте сценарии от простого к сложному
Тестируйте каждую UserStory минимум 5 вариациями формулировок
Проверяйте edge cases: опечатки, разные языки, смешанный текст, длинные диалоги, вызовы тулов, обновления файлов/данных в диалогах
Не игнорируйте flaky проблемы и нестабильно воспроизводимые ошибки!
Частые проблемы и дефекты:

Агент не понимает синонимы/перифразы/аналоги
Теряет контекст после 20+ сообщений
Не запрашивает недостающие параметры
Выполняет задачу частично без подтверждения
Отсутствует HITL для подтверждения важных действий
Зацикливается на одном/нескольких инструментах
Не предоставляет информацию о размышлениях/вызовах тулов
Игнорирует ошибки API
Выводит технические сообщения (допускается только в отладочном режиме для тестирования)
Общие фразы вместо конкретных шагов
Устаревшие данные (цены, адреса, факты, несоответствие доменной документации/специфике)
